
# Sessão 3 – Docker Compose + Django + PostgreSQL

## Objetivo da sessão
- Orquestrar múltiplos containers.
- Subir Django + PostgreSQL + Redis.
- Usar variáveis de ambiente.
- Preparar imagem para produção.

---

## 1. docker-compose.yml
```yaml
version: '3.8'
services:
  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: django_db
      POSTGRES_USER: django_user
      POSTGRES_PASSWORD: django_password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  web:
    build: .
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - .:/app
    ports:
      - "8000:8000"
    environment:
      DEBUG: "True"
      SECRET_KEY: "change-me"
      DATABASE_URL: "postgresql://django_user:django_password@db:5432/django_db"
    depends_on:
      - db

  redis:
    image: redis:7-alpine

volumes:
  postgres_data:
```

---

## 2. Configurando Django para PostgreSQL
```python
import dj_database_url
database_url = config('DATABASE_URL')
DATABASES = {'default': dj_database_url.config(default=database_url)}
```

---

## 3. Subindo ambiente
```bash
docker-compose up --build
```

---

## 4. Comandos úteis
```bash
docker-compose logs -f web
docker-compose exec web python manage.py migrate
```

---

## 5. Dockerfile para produção (Gunicorn)
```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["gunicorn", "myproject.wsgi:application", "--bind", "0.0.0.0:8000"]
```
